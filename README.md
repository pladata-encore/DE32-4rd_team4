# 플레이데이터 DE_32기 Team_Project_4rd 4조

<img src="https://github.com/user-attachments/assets/82474abc-867d-42c6-ba65-50cb2638d836" align="center" width="700" height="400" />

http://3.38.92.60:7777/

## 팀 소개

|이름|역할 및 담당 업무|깃허브|
|---|------|---|
|이정훈|인프라 셋팅, Spring-카프카 연동|링크|
|최하람|Spring-회원 로그인 서비스 |링크|
|김령래|Spark 데이터 집계|링크|
|정세현|Airflow Dags|링크|
|김예지|Spring-회원 가입 서비스|링크|

## 기술 스택

- Ubuntu
- Kafka
- Spark
- Spring boot
- Docker
- Maria DB

## 프로젝트 일정
| 프로젝트 일정 : 2024년 10월 24일 ~ 2024년 10월 27일(총 4일)

## 프로젝트 개요
| 사내 채팅 로그를 분석하여 가장 많이 채팅을 많이 하는 사람과 가장 많이 활발하게 채팅이 운영되고 있는 방들을 집계

## 기능 명세

### 사용자
| 기능명            | 요구사항 설명                                 | 구현 상태 |
|-----------------|------------------------------------------|----------|
| 회원가입         | 사용자 정보를 받아 회원가입 처리                    | ✅ |
| 로그인           | 이메일과 비밀번호를 통해 로그인 처리 및 세션 관리         | ✅ |
| 로그아웃         | 세션을 무효화하여 로그아웃 처리                    | ✅ |
| 프로필 이미지 수정 | 사용자의 프로필 이미지를 파일로 업로드하여 업데이트        | ✅ |

---

### 채팅
| 기능명                | 요구사항 설명                               | 구현 상태 |
|---------------------|------------------------------------------|----------|
| 채팅방 생성           | 요청 정보를 기반으로 새로운 채팅방을 생성                 | ✅ |
| 모든 채팅방 조회        | 모든 채팅방 정보를 가져와 조회                      | ✅ |
| 내가 가입된 채팅방 조회     | 사용자가 가입된 채팅방 목록을 조회                   | ✅ |
| 특정 채팅방 제목 조회     | 특정 채팅방의 제목을 조회                        | ✅ |
| 특정 채팅방 메시지 조회    | 특정 채팅방에 속한 메시지 목록을 조회                  | ✅ |
| 채팅방 사용자 초대       | 사용자 ID를 통해 특정 채팅방으로 초대                  | ✅ |
| 채팅방 참여자 조회       | 특정 채팅방에 참여 중인 사용자 목록 조회                | ✅ |
| 이메일로 사용자 검색      | 이메일을 기반으로 사용자 정보 조회                   | ✅ |
| 채팅방 삭제           | 특정 채팅방을 삭제                              | ✅ |

---

### 메시지
| 기능명               | 요구사항 설명                               | 구현 상태 |
|--------------------|------------------------------------------|----------|
| 메시지 전송           | 메시지를 서버로 전송하고 WebSocket으로 전달             | ✅ |
| 특정 채팅방 메시지 조회 | 특정 채팅방의 메시지 목록을 조회                      | ✅ |


---

### Airflow
| 기능명               | 요구사항 설명                               | 구현 상태 |
|--------------------|------------------------------------------|----------|
| 메시지 전송           | 메시지를 서버로 전송하고 WebSocket으로 전달             | ✅ |
| ID별 요청 횟수 확인 | ID별 요청 횟수 조회                         | ✅ |

---

### 집계
| 기능명               | 요구사항 설명                               | 구현 상태 |
|--------------------|------------------------------------------|----------|
| 메시지 전송           | 메시지를 서버로 전송하고 WebSocket으로 전달             | ✅ |
| ID별 요청 횟수 확인 | ID별 요청 횟수 조회                      | ✅ |

---

## 화면
| 로그인             | 회원가입                               |
|--------------------|------------------------------------------|
| ![image](https://github.com/user-attachments/assets/f9a1d479-0a02-46ec-95c6-bea6877e5cc3)           | ![image](https://github.com/user-attachments/assets/1ede4383-f440-4f11-9a85-2de31f5b13c3)            |



| 채팅방             | 참가 목록 및 초대                               |
|--------------------|------------------------------------------|
| ![image](https://github.com/user-attachments/assets/941bac76-0075-4d7e-b98e-95bbe1b27317)           | ![image](https://github.com/user-attachments/assets/c77102d6-6458-4269-b7af-3a2046e10cc8)             |

## 기술 도입 및 개선

### SPARK STREAMING API 도입
- SPARK STREAMING API를 사용하여 Kafka에서 직접 데이터 습득 -> JSON의 중복 저장을 피해 저장 효율 증가

```bash
df = spark \
  .read \
  .format("kafka") \
  .option("kafka.bootstrap.servers", bootstrap_server) \
  .option("assign", '{"message-topic":[0]}') \
  .load()
```
  
### ID 기준 파티셔닝 저장
- ID별 분석을 많이 사용할 것으로 확인되어 ID 칼럼 기준으로 파티셔닝 -> 데이터 저장 및 검색 시 효율 증가

```bash
df.write.partitionBy("request_senderId").parquet(save_dir, mode="overwrite")  # 'overwrite' 모드로 저장
```

### Streamlit 캐시 기능
- 거의 모든 함수에서 load_data()를 사용
- 파일 입출력 시간을 줄이기 위해 Streamlit의 캐시 기능을 적용
- 캐시 용량 초과 문제 발생하지 않도록 ttl이라는 속성을 통해 캐시 저장 시간 관리

```bash
@st.cache_data(ttl=120)
def load_data():
  ...
```
